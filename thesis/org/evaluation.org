
* Translation Quality on WMT 21 test set

  Data source:
  Teacher models: ~/wmt21/teachers/continued_on_parallel
  Student models: ~/wmt21/efficiency

  Each dir contains a results/ folder, containing the translations and the scores.
  Ensembles are out of 4 models, single models are en-de_1 or de-en_1.








** English-German

   #+NAME: endetrqual
   |---------------------------+--------+--------+--------+----------+---------+---------+---------+-----------+------+----------|
   | Model                     | ChrF A | ChrF C | ChrF D | ChrF Avg | COMET A | COMET C | COMET D | COMET Avg | BLEU | BLEU Var |
   |---------------------------+--------+--------+--------+----------+---------+---------+---------+-----------+------+----------|
   | Single greedy AR          |        |        |        |          |         |         |         |           |      |          |
   | Large                     |   56.4 |   61.0 |   60.1 |     59.2 |  0.3801 |  0.4341 |  0.4189 |    0.4110 | 50.5 |      1.3 |
   | Base                      |   55.6 |   59.9 |   58.9 |     58.1 |  0.3594 |  0.4088 |  0.3962 |    0.3881 | 47.9 |      1.3 |
   |                           |        |        |        |          |         |         |         |           |      |          |
   | Single beam AR            |        |        |        |          |         |         |         |           |      |          |
   | Large                     |   56.1 |   60.5 |   59.8 |     58.8 |  0.3770 |  0.4257 |  0.4133 |    0.4053 | 50.8 |      1.3 |
   | Base                      |   55.4 |   59.7 |   58.6 |     57.9 |  0.3598 |  0.4067 |  0.3955 |    0.3873 | 48.0 |      1.3 |
   |                           |        |        |        |          |         |         |         |           |      |          |
   | Ensemble beam AR          |        |        |        |          |         |         |         |           |      |          |
   | Large                     |   56.5 |   61.4 |   60.5 |     59.5 |  0.4015 |  0.4571 |  0.4411 |    0.4332 | 52.2 |      1.3 |
   |---------------------------+--------+--------+--------+----------+---------+---------+---------+-----------+------+----------|
   | Non-autoregressive models |        |        |        |          |         |         |         |           |      |          |
   | Large                     |   55.9 |   60.5 |   59.4 |     58.6 |  0.1155 |  0.1756 |  0.1544 |    0.1485 | 47.8 |      1.2 |
   | Base                      |   54.1 |   58.0 |   56.7 |     56.3 | -0.0753 | -0.0282 | -0.0528 |   -0.0521 | 41.8 |      1.1 |
   | Small                     |   54.0 |   57.9 |   56.8 |     56.2 | -0.1024 | -0.0500 | -0.0731 |   -0.0752 | 41.9 |      1.1 |
   | Micro                     |   55.1 |   58.9 |   57.8 |     57.3 | -0.0338 |  0.0159 | -0.0071 |   -0.0083 | 43.5 |      1.1 |
   | Tiny                      |   51.8 |   55.0 |   54.0 |     53.6 | -0.3538 | -0.3116 | -0.3346 |   -0.3333 | 34.7 |      1.0 |
   |---------------------------+--------+--------+--------+----------+---------+---------+---------+-----------+------+----------|
   #+TBLFM: $5=vmean($2..$4);%0.1f
   #+TBLFM: $9=vmean($6..$8);%0.4f

*** Export

   |---------------------------+----------+-----------+------+----------|
   | Model                     | ChrF Avg | COMET Avg | BLEU | BLEU Var |
   |---------------------------+----------+-----------+------+----------|
   | Single greedy AR          |          |           |      |          |
   | Large                     |     59.2 |    0.4110 | 50.5 |      1.3 |
   | Base                      |     58.1 |    0.3881 | 47.9 |      1.3 |
   |                           |          |           |      |          |
   | Single beam AR            |          |           |      |          |
   | Large                     |     58.8 |    0.4053 | 50.8 |      1.3 |
   | Base                      |     57.9 |    0.3873 | 48.0 |      1.3 |
   |                           |          |           |      |          |
   | Ensemble beam AR          |          |           |      |          |
   | Large                     |     59.5 |    0.4332 | 52.2 |      1.3 |
   |---------------------------+----------+-----------+------+----------|
   | Non-autoregressive models |          |           |      |          |
   | Large                     |     58.6 |    0.1485 | 47.8 |      1.2 |
   | Base                      |     56.3 |   -0.0521 | 41.8 |      1.1 |
   | Small                     |     56.2 |   -0.0752 | 41.9 |      1.1 |
   | Micro                     |     57.3 |   -0.0083 | 43.5 |      1.1 |
   | Tiny                      |     53.6 |   -0.3333 | 34.7 |      1.0 |
   |---------------------------+----------+-----------+------+----------|



** German-English

   #+NAME: deentrqual
   |---------------------------+--------+--------+----------+---------+---------+-----------+------+----------|
   | Model                     | ChrF A | Chrf B | ChrF Avg | COMET A | COMET B | COMET Avg | BLEU | BLEU Var |
   |---------------------------+--------+--------+----------+---------+---------+-----------+------+----------|
   | Single greedy AR          |        |        |          |         |         |           |      |          |
   | Large                     |   60.2 |   63.5 |     61.9 |  0.5789 |  0.5947 |    0.5868 | 48.4 |      1.3 |
   | Base                      |   59.5 |   62.4 |     61.0 |  0.5447 |  0.5616 |    0.5532 | 47.0 |      1.3 |
   |                           |        |        |          |         |         |           |      |          |
   | Single beam AR            |        |        |          |         |         |           |      |          |
   | Large                     |   59.9 |   63.1 |     61.5 |  0.5777 |  0.5992 |    0.5885 | 49.2 |      1.2 |
   | Base                      |   59.4 |   62.0 |     60.7 |  0.5453 |  0.5616 |    0.5534 | 47.4 |      1.3 |
   |                           |        |        |          |         |         |           |      |          |
   | Ensemble beam AR          |        |        |          |         |         |           |      |          |
   | Large                     |   60.3 |   63.8 |     62.0 |  0.5818 |  0.6090 |    0.5954 | 50.6 |      1.3 |
   |---------------------------+--------+--------+----------+---------+---------+-----------+------+----------|
   | Non-autoregressive models |        |        |          |         |         |           |      |          |
   | Large                     |   60.3 |   63.0 |     61.6 |  0.3207 |  0.3385 |    0.3296 | 46.4 |      1.4 |
   | Base                      |   60.1 |   62.7 |     61.4 |  0.2923 |  0.2991 |    0.2957 | 45.8 |      1.3 |
   | Small                     |   59.9 |   62.2 |     61.0 |  0.2420 |  0.2503 |    0.2462 | 44.6 |      1.3 |
   | Micro                     |   58.5 |   60.8 |     59.6 |  0.1466 |  0.1485 |    0.1475 | 42.3 |      1.4 |
   | Tiny                      |   55.2 |   56.5 |     55.9 | -0.1539 | -0.1578 |   -0.1558 | 34.4 |      1.3 |
   |---------------------------+--------+--------+----------+---------+---------+-----------+------+----------|
   #+TBLFM: $4=vmean($2..$3);%0.1f
   #+TBLFM: $7=vmean($5..$6);%0.4f


*** Export
   |---------------------------+----------+-----------+------+----------|
   | Model                     | ChrF Avg | COMET Avg | BLEU | BLEU Var |
   |---------------------------+----------+-----------+------+----------|
   | Single greedy AR          |          |           |      |          |
   | Large                     |     61.9 |    0.5868 | 48.4 |      1.3 |
   | Base                      |     61.0 |    0.5532 | 47.0 |      1.3 |
   |                           |          |           |      |          |
   | Single beam AR            |          |           |      |          |
   | Large                     |     61.5 |    0.5885 | 49.2 |      1.2 |
   | Base                      |     60.7 |    0.5534 | 47.4 |      1.3 |
   |                           |          |           |      |          |
   | Ensemble beam AR          |          |           |      |          |
   | Large                     |     62.0 |    0.5954 | 50.6 |      1.3 |
   |---------------------------+----------+-----------+------+----------|
   | Non-autoregressive models |          |           |      |          |
   | Large                     |     61.6 |    0.3296 | 46.4 |      1.4 |
   | Base                      |     61.4 |    0.2957 | 45.8 |      1.3 |
   | Small                     |     61.0 |    0.2462 | 44.6 |      1.3 |
   | Micro                     |     59.6 |    0.1475 | 42.3 |      1.4 |
   | Tiny                      |     55.9 |   -0.1558 | 34.4 |      1.3 |
   |---------------------------+----------+-----------+------+----------|


* Translation on WMT 14

  |-------+------------+-----------------+-------------+-----------------+-------------+-----------------+-------------+-----------------|
  | Model | En-De 300k | En-De @300k AVG | En-De Final | En-De Final AVG | De-En @300k | De-En @300k AVG | De-En Final | De-En Final AVG |
  |-------+------------+-----------------+-------------+-----------------+-------------+-----------------+-------------+-----------------|
  |       |            |                 |             |                 |             |                 |             |                 |
  |-------+------------+-----------------+-------------+-----------------+-------------+-----------------+-------------+-----------------|
  | Large |       27.6 |            27.7 |        28.1 |            28.4 |        29.5 |            30.0 |        30.9 |            31.3 |
  | Base  |       22.4 |            22.4 |        23.7 |            23.7 |        27.7 |            28.1 |        29.8 |            30.3 |
  | Small |       22.4 |            22.5 |        23.7 |            23.6 |        26.5 |            26.7 |        28.7 |            29.1 |
  | Micro |       23.6 |            23.7 |        25.1 |            25.0 |        25.5 |            25.1 |        27.2 |            27.5 |
  | Tiny  |       19.0 |            19.0 |        20.3 |            20.3 |        19.5 |            19.6 |        21.5 |            21.7 |
  |-------+------------+-----------------+-------------+-----------------+-------------+-----------------+-------------+-----------------|


* Decoding speed on efficiency data

  Is tied faster than non-tied?

  1M sentences

** CPU - IceLake

*** Latency

  |---------+----------------------------+------------------------|
  | Model   | Latency - CPU 1 Core (x10) | Latency - CPU 36 cores |
  |---------+----------------------------+------------------------|
  | AR Big  |                            |                        |
  | AR Base |                            |                  52087 |
  |---------+----------------------------+------------------------|
  | Large   |                      35013 |                  14542 |
  | Base    |                       9463 |                   3508 |
  | Small   |                       6196 |                   2346 |
  | Micro   |                       5108 |                   1952 |
  | Tiny    |                       1581 |                    784 |
  |---------+----------------------------+------------------------|



*** Throughput

  Different batch sizes on 36 cores

  |---------+------|
  | Model   | b=64 |
  |---------+------|
  | AR Base | 9370 |
  |---------+------|
  | Large   | 8238 |
  | Base    | 2934 |
  | Small   | 1936 |
  | Micro   | 1607 |
  | Tiny    |  701 |
  |---------+------|

*** Shortlist at 36 CPU cores

    |---------+------+------+------+------+------+------+------|
    | Batch   |    1 |    2 |    4 |    8 |   16 |   32 |   64 |
    |---------+------+------+------+------+------+------+------|
    | AR Big  |      |      |      |      |      |      |      |
    | Ar Base |      |      |      |      |      |      |      |
    |---------+------+------+------+------+------+------+------|
    | Large   |      |      | 8245 | 7545 | 7434 | 7511 | 7639 |
    | Base    | 2549 | 2298 | 2263 | 2306 | 2399 | 2503 | 2609 |
    | Small   | 1346 | 1246 | 1250 | 1306 | 1399 | 1497 | 1606 |
    | Micro   |  958 |  897 |  913 |  974 | 1062 | 1163 | 1271 |
    | Tiny    |  244 |  246 |  273 |  316 |  373 |  437 |  506 |
    |---------+------+------+------+------+------+------+------|





** GPU

*** Latency

    these are the same numbers as in throughput table column 1

    |----------+---------------------+---------------------|
    | Model    | GPU Latency -- P100 | GPU Latency -- A100 |
    |----------+---------------------+---------------------|
    | AR Large |                     |                     |
    | AR Base  |                     |                     |
    |----------+---------------------+---------------------|
    | Large    |               14157 |                     |
    | Base     |                8720 |                     |
    | Small    |                5017 |                     |
    | Micro    |                3781 |                     |
    | Tiny     |                1916 |                     |
    |----------+---------------------+---------------------|

*** Throughput

**** P100 MAX LENGTH 100

     |-----------------+-------+-------+-------+-------+-------+-------+------+------|
     | Batch size      |     1 |     2 |     4 |     8 |    16 |    32 |   64 |  128 |
     |-----------------+-------+-------+-------+-------+-------+-------+------+------|
     | AR Large        |       |       | 44838 | 26231 | 16741 | 11266 | 8926 | 7449 |
     | AR Base (stdnt) |       | 61965 | 33957 | 18503 | 11087 |  6677 | 4503 | 3409 |
     |-----------------+-------+-------+-------+-------+-------+-------+------+------|
     | Large           | 14157 | 10285 |  8079 |  7003 |  6452 |  6056 | 5767 | 5581 |
     | Base            |  8720 |  5532 |  3875 |  3146 |  2769 |  2535 | 2394 | 2303 |
     | Small           |  5017 |  3270 |  2376 |  1977 |  1748 |  1635 | 1564 | 1512 |
     | Micro           |  3781 |  2462 |  1871 |  1579 |  1418 |  1343 | 1282 | 1248 |
     | Tiny            |  1916 |  1295 |   960 |   803 |   730 |   687 |  666 |  652 |
     |-----------------+-------+-------+-------+-------+-------+-------+------+------|

**** Export

     transposed for gnuplot:

  | Batch size | AR Large | AR Base | Large | Base | Small | Micro | Tiny |
  |          1 |          |         | 14157 | 8720 |  5017 |  3781 | 1916 |
  |          2 |          |   61965 | 10285 | 5532 |  3270 |  2462 | 1295 |
  |          4 |    44838 |   33957 |  8079 | 3875 |  2376 |  1871 |  960 |
  |          8 |    26231 |   18503 |  7003 | 3146 |  1977 |  1579 |  803 |
  |         16 |    16741 |   11087 |  6452 | 2769 |  1748 |  1418 |  730 |
  |         32 |    11266 |    6677 |  6056 | 2535 |  1635 |  1343 |  687 |
  |         64 |     8926 |    4503 |  5767 | 2394 |  1564 |  1282 |  666 |
  |        128 |     7449 |    3409 |  5581 | 2303 |  1512 |  1248 |  652 |


**** A100 MAX LENGTH 100

     |-----------------+------+------+------+-------+------+------+------+------|
     | Batch size      |    1 |    2 |    4 |     8 |   16 |   32 |   64 |  128 |
     |-----------------+------+------+------+-------+------+------+------+------|
     | Ar Large        |      |      |      |       |      |      | 3090 | 1918 |
     | Ar Base (stdnt) |      |      |      | 13836 | 7498 | 3997 | 2371 | 1465 |
     |-----------------+------+------+------+-------+------+------+------+------|
     | Large           | 7020 | 3874 | 2292 |  1547 | 1179 |  973 |  850 |  782 |
     | Base            | 6289 | 3400 | 1854 |  1166 |  816 |  635 |  542 |  485 |
     | Small           | 3300 | 1860 | 1051 |   717 |  526 |  434 |  380 |  357 |
     | Micro           | 2322 | 1345 |  833 |   544 |  433 |  367 |  332 |  311 |
     | Tiny            | 1360 |  780 |  503 |   367 |  301 |  273 |  252 |  243 |
     |-----------------+------+------+------+-------+------+------+------+------|

**** Export

     | Batch size | Ar Large | Ar Base (stdnt) | Large | Base | Small | Micro | Tiny |
     |          1 |          |                 |  7020 | 6289 |  3300 |  2322 | 1360 |
     |          2 |          |                 |  3874 | 3400 |  1860 |  1345 |  780 |
     |          4 |          |                 |  2292 | 1854 |  1051 |   833 |  503 |
     |          8 |          |           13836 |  1547 | 1166 |   717 |   544 |  367 |
     |         16 |          |            7498 |  1179 |  816 |   526 |   433 |  301 |
     |         32 |          |            3997 |   973 |  635 |   434 |   367 |  273 |
     |         64 |     3090 |            2371 |   850 |  542 |   380 |   332 |  252 |
     |        128 |     1918 |            1465 |   782 |  485 |   357 |   311 |  243 |

* Old stuff
  The NAT models in these tables are with max-length set to 100. AR models are
  with max length 150. Boooo

  Also, the real problem was not the max length, but the batch size - with
  batch > 1, the sentences got decoded to the max length, instead of 3x src
  length.

** English-German
  |-------------------+---------------------------+---------------------------------------+------------|
  | EN -> DE          | Chrf                      | COMET                                 | BLEU       |
  |-------------------+---------------------------+---------------------------------------+------------|
  | Single Greedy AR  |                           |                                       |            |
  | Large             | 56.4 / 61.0 / 60.1 = 59.2 | 0.3801 / 0.4341 / 0.4189 = 0.4110     | 50.5 @ 1.3 |
  | Base              | 55.6 / 59.9 / 58.9 = 58.1 | 0.3594 / 0.4088 / 0.3962 = 0.3881     | 47.9 @ 1.3 |
  |-------------------+---------------------------+---------------------------------------+------------|
  | Single Beam 12 AR |                           |                                       |            |
  | Large             | 56.1 / 60.5 / 59.8 = 58.8 | 0.3770 / 0.4257 / 0.4133 = 0.4053     | 50.8 @ 1.3 |
  | Base              | 55.4 / 59.7 / 58.6 = 57.9 | 0.3598 / 0.4067 / 0.3955 = 0.3873     | 48.0 @ 1.3 |
  |-------------------+---------------------------+---------------------------------------+------------|
  | Ensemble Beam AR  |                           |                                       |            |
  | Large             | 56.5 / 61.4 / 60.5 = 59.5 | 0.4015 / 0.4571 / 0.4411 = 0.4332     | 52.2 @ 1.3 |
  |-------------------+---------------------------+---------------------------------------+------------|
  | NAR               |                           |                                       |            |
  | Large             | 55.9 / 60.5 / 59.4 = 58.6 | +0.0580 /  0.1174 /  0.0972 =  0.0909 | 47.4 @ 1.1 |
  | Base              | 54.0 / 58.0 / 56.7 = 56.2 | -0.1138 / -0.0674 / -0.0931 = -0.0914 | 41.4 @ 1.1 |
  | Small             | 54.0 / 57.9 / 56.7 = 56.2 | -0.1224 / -0.0710 / -0.0937 = -0.0957 | 41.7 @ 1.1 |
  | Micro             | 55.0 / 58.9 / 57.8 = 57.2 | -0.0884 / -0.0390 / -0.0618 = -0.0631 | 43.2 @ 1.1 |
  | Tiny              | 51.8 / 55.0 / 53.9 = 53.6 | -0.4170 / -0.3760 / -0.3983 = -0.3971 | 34.5 @ 1.0 |
  |-------------------+---------------------------+---------------------------------------+------------|

** German-English
  |-------------------+--------------------+-----------------------------+------------|
  | DE -> EN          | Chrf               | COMET                       | BLEU       |
  |-------------------+--------------------+-----------------------------+------------|
  | Single Greedy AR  |                    |                             |            |
  | Large             | 60.2 / 63.5 = 61.9 | 0.5789 / 0.5947 = 0.5868    | 48.4 @ 1.3 |
  | Base              | 59.5 / 62.4 = 61.0 | 0.5447 / 0.5616 = 0.5532    | 47.0 @ 1.3 |
  |-------------------+--------------------+-----------------------------+------------|
  | Single Beam 12 AR |                    |                             |            |
  | Large             | 59.9 / 63.1 = 61.5 | 0.5777 / 0.5992 = 0.5885    | 49.2 @ 1.2 |
  | Base              | 59.4 / 62.0 = 60.7 | 0.5453 / 0.5616 = 0.5535    | 47.4 @ 1.3 |
  |-------------------+--------------------+-----------------------------+------------|
  | Ensemble Beam AR  |                    |                             |            |
  | Large             | 60.3 / 63.8 = 62.1 | 0.5818 / 0.6090 = 0.5954    | 50.6 @ 1.3 |
  |-------------------+--------------------+-----------------------------+------------|
  | NAR               |                    |                             |            |
  | Large             | 60.2 / 62.9 = 61.6 | +0.3032 / +0.3207 = +0.3120 | 45.3 @ 1.3 |
  | Base              | 60.0 / 62.6 = 61.3 | +0.2702 / +0.2709 = +0.2706 | 44.9 @ 1.2 |
  | Small             | 59.8 / 62.1 = 61.0 | +0.2152 / +0.2236 = +0.2194 | 43.9 @ 1.2 |
  | Micro             | 58.4 / 60.7 = 59.6 | +0.1151 / +0.1186 = +0.1169 | 41.8 @ 1.3 |
  | Tiny              | 55.1 / 56.4 = 55.8 | -0.1785 / -0.1815 = -0.1800 | 34.2 @ 1.3 |
  |-------------------+--------------------+-----------------------------+------------|
